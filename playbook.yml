#playbook
---
- name: Ansible archive Examples
  hosts: all
  tasks:
  - name: Getting timestamp
    shell: date +'%Y%m%d%H%M%S'
    register: timestamp_raw

  - name: Getting name for backup
    set_fact: timestamp={{ timestamp_raw.stdout }}

   #- name: Deleting old backup files
   # file: path={{ /usr/test }}/backup state=absent

  - name: Compress Directory contents
    become: yes
    archive:
       path: /usr/test/
       dest: /usr/test/backup_{{ timestamp }}.tar  
       format: tar
